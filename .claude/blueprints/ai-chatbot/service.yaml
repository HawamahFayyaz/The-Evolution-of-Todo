# ============================================================
# SERVICES - Network access to AI Chatbot components
# ============================================================
# Frontend:   LoadBalancer (external access)
# Backend:    ClusterIP (internal, accessed via Ingress)
# MCP Server: ClusterIP (internal, called by backend)
# PostgreSQL: ClusterIP (internal, called by backend/mcp)
# ============================================================

---
# ==================== FRONTEND SERVICE ====================
# External access via LoadBalancer
apiVersion: v1
kind: Service
metadata:
  name: {{app.name}}-frontend
  namespace: {{app.namespace}}
  labels:
    app: {{app.name}}-frontend
    component: frontend
spec:
  type: LoadBalancer
  selector:
    app: {{app.name}}-frontend
  ports:
  - name: http
    port: {{frontend.port.service}}
    targetPort: {{frontend.port.container}}
    protocol: TCP

---
# ==================== BACKEND SERVICE ====================
# Internal access via Ingress /api/*
apiVersion: v1
kind: Service
metadata:
  name: {{app.name}}-backend
  namespace: {{app.namespace}}
  labels:
    app: {{app.name}}-backend
    component: backend
spec:
  type: ClusterIP
  selector:
    app: {{app.name}}-backend
  ports:
  - name: http
    port: {{backend.port.service}}
    targetPort: {{backend.port.container}}
    protocol: TCP

---
# ==================== MCP SERVER SERVICE ====================
# Internal only - called by backend for tool execution
apiVersion: v1
kind: Service
metadata:
  name: {{app.name}}-mcp-server
  namespace: {{app.namespace}}
  labels:
    app: {{app.name}}-mcp-server
    component: mcp-server
spec:
  type: ClusterIP
  selector:
    app: {{app.name}}-mcp-server
  ports:
  - name: http
    port: {{mcpServer.port.service}}
    targetPort: {{mcpServer.port.container}}
    protocol: TCP

---
# ==================== POSTGRESQL SERVICE ====================
# Internal only - called by backend and mcp-server
apiVersion: v1
kind: Service
metadata:
  name: {{postgres.name}}
  namespace: {{app.namespace}}
  labels:
    app: {{postgres.name}}
    component: database
spec:
  type: ClusterIP
  selector:
    app: {{postgres.name}}
  ports:
  - name: postgres
    port: {{postgres.port.service}}
    targetPort: {{postgres.port.container}}
    protocol: TCP

---
# ==================== HEADLESS SERVICE FOR STATEFULSET ====================
# Required for StatefulSet DNS resolution
apiVersion: v1
kind: Service
metadata:
  name: {{postgres.name}}-headless
  namespace: {{app.namespace}}
  labels:
    app: {{postgres.name}}
    component: database
spec:
  type: ClusterIP
  clusterIP: None
  selector:
    app: {{postgres.name}}
  ports:
  - name: postgres
    port: {{postgres.port.service}}
    targetPort: {{postgres.port.container}}
